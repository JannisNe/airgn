channel:
- access:
  - ZTF_PUB
  name: wise
  policy: []
  version: 0
mongo:
  prefix: simulate_steady
  reset: false
name: timewise
task:
- config:
    compiler_opts: TiCompilerOptions
    directives:
    - channel: wise
      filter:
        unit: TimewiseFilter
      ingest:
        mux:
          combine:
          - state_t2:
            - unit: T2StackVisits
              config: &stacking_config
                outlier_threshold: 5
            - unit: T2CalculateChi2
            - unit: T2CalculateChi2Stacked
              config:
                t2_dependency:
                - unit: T2StackVisits
                  config: *stacking_config
            - unit: T2CalculateMedians
              config:
                t2_dependency:
                  - unit: T2StackVisits
                    config: *stacking_config
            unit: T1SimpleCombiner
          unit: TiMongoMuxer
    iter_max: 100000
    shaper: TiDataPointShaper
    supplier:
      config:
        dpid: hash
        loader:
          config:
            n_sample: 1000
            n_visits: 20
            n_detections_per_visit: 14
          unit: TimewiseAlertSimulator
      unit: TimewiseAlertSupplier
  multiplier: 1
  title: t0
  template:
    live:
      - resolve_run_time_aliases
      - hash_t2_config
  unit: AlertConsumer


- config:
    log_profile: default
  multiplier: 5
  title: t2
  unit: T2Worker


- title: PlotChi2
  unit: T3Processor
  config:
    raise_exc: true
    supply:
      unit: T3DefaultBufferSupplier
      config:
        select:
          unit: T3StockSelector
          config:
            channel: "wise"
        load:
          unit: T3SimpleDataLoader
          config:
            directives:
              - T2DOC
            channel: "wise"
    stage:
      unit: T3SimpleStager
      config:
        execute:
          - unit: PlotChi2Distribution
            config:
              path: /Users/jannisnecker/Software/airgn/plots/simulate_steady_chi2.pdf
              plot_dir: /Users/jannisnecker/Software/airgn/plots/nedlvs_chi2/
              cumulative: true
              upper_lim: 2
              n1: 20
              n2: 14